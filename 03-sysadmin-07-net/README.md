# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?
   Linux:

   `ip a`

   `ip link`

   `ifconfig`

   Windows:

   `ipconfig`

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

   Протокол: `lldpd`

   Пакет: `lldpd`

   Команда: `lldpctl`

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

   Технология: `vlan` – виртуальное разделение коммутатора

   Пакет: `vlan`

   Команда `vconfig`
   ```bash
   # cat/etc/network/interfaces
   auto vlan.1400
   iface vlan.1400 inet static
           address 192.168.1.1
           netmask 255.255.255.0
           vlan_raw_device eth0
   ```

   Номер `1400` в данном случае указывает на то, какой `VLAN ID` должен использоваться

   `vlan_raw_device` - этот параметр указывает, на каком сетевом интерфейсе должен создаваться новый интерфейс `vlan1400`

   Также можно использовать названия интерфейсов вида `eth0.1400`, а не `vlan1400`
   ```bash
   # cat/etc/network/interfaces
   auto eth0.1400
   iface eth0.1400 inet static
           address 192.168.1.1
           netmask 255.255.255.0
           vlan_raw_device eth0
   ```




4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

   Типы типы агрегации интерфейсов в Linux:
   ```bash
   ● статический (на Cisco mode on);
   ● динамический – LACP протокол (на Cisco mode active).
   ```

   Какие опции есть для балансировки нагрузки:

    - `mode` - Параметр, выбирающий режим работы, возможные значения:
      ```bash
      - balance-rr (0)
      - active-backup (1)
      - balance-xor (2)
      - broadcast (3)
      - 802.3ad (4)
      - balance-tlb (5)
      - balance-alb (6)
      ```
      Режим по умолчанию `balance-rr` (round robin)
   - `miimon`
     Число мс (тип integer) – как часто производится мониторинг MII статуса. 0 – мониторинг отключен. Рекомендуемое значение 100 мс.

   - `arp_interval`
     Задает частоту мониторинга канала ARP в миллисекундах. Мониторинг ARP не следует использовать вместе с `miimon`. Значение 0 отключает мониторинг ARP. Значение по умолчанию - 0.

   - `arp_ip_target`
     Указывает IP-адреса, которые будут использоваться в качестве одноранговых узлов      мониторинга ARP, когда `arp_interval` > 0. Это цели запроса ARP, отправляемого для  определения работоспособности линка до цели. Несколько IP-адресов должны быть      разделены запятой. Для работы мониторинга ARP необходимо указать хотя бы один      IP-адрес. Максимальное количество целей, которое можно указать - 16. Значение по      умолчанию - отсутствие IP-адресов.


     Очень важно указать параметры miimon или arp_interval и arp_ip_target, в противном случае при сбоях канала произойдет серьезная деградация сети. Очень немногие устройства не поддерживают хотя бы miimon, поэтому нет причин не использовать его.

   - `downdelay`
     Задержка в мс (тип integer) с того момента, как было обнаружено, что связь пропала,  до того, как данный канал перестанет использоваться. Задержка нужна, чтобы  отфильтровывать кратковременные сбои. Например, после переключения патчкорда в течение  нескольких секунд совсем не обязательно терять связь на минуту или больше.
     Эта опция действительна только для монитора соединения `miimon`. Значение задержки  должно быть кратно значению `miimon`; в противном случае оно будет округлено до  ближайшего кратного
     По умолчанию используется 0 – нет задержки.

   - `updelay`
     То же самое, что и downdelay, но определяющее задержку по включению, на тот случай,   если какой-нибудь switch или hub «не до конца включились». Напряжение на порт   подано, а пакеты ещё корректно не принимаются. Если в этот момент передать данные –   они потеряются, а если немного подождать, то этого не случится.

   Приведите пример конфига

      Centos/Red Hat

      Загрузка необходимого модуля ядра
      ```bash
      # modprobe --first-time bonding
      ```
      Просмотр информации о загрженном модуле bonding
      ```bash
      # modinfo bonding
      ```

      Создание бондинга через `nmcli`-утилиту - командную строку `NetworkManager`

      Создание bond-интерфейса
      ```bash
      # nmcli con add type bond ifname mybond0 bond.options "mode=balance-rr,miimon=100,downdelay=5000,updelay=2000"
      ```
      Создание добавления `slave`-интерфейсов `ens3` и `ens7` к созданному `bond`-интерфейсу `mybond0`
      ```bash
      # nmcli con add type ethernet ifname ens3 master mybond0
      ```
      ```bash
      # nmcli con add type ethernet ifname ens7 master mybond0
      ```

      Активация/запуск `slave`-интерфейсов

      При этом `master`-интерфейс `mybond0` будет активирован/запущен автоматически(нет
      необходимости активировать `master` вручную дополнительно)
      ```bash
      # nmcli con up bond-slave-ens7
      ```
      ```bash
      # nmcli con up bond-slave-ens3
      ```

      Создание бондинга через конфигурационные файлы `ifcfg-*`

      ```bash
      # cat /etc/sysconfig/network-scripts/ifcfg-bond0
      DEVICE=bond0
      NAME=bond0
      TYPE=Bond
      BONDING_MASTER=yes
      IPADDR=192.168.1.1
      PREFIX=24
      ONBOOT=yes
      BOOTPROTO=none
      BONDING_OPTS="mode=balance-rr miimon=100 downdelay=5000 updelay=2000"
      NM_CONTROLLED="no"
      ```
      ```bash
      # cat /etc/sysconfig/network-scripts/ifcfg-ens3
      DEVICE=ens3
      NAME=bond0-slave
      TYPE=Ethernet
      BOOTPROTO=none
      ONBOOT=yes
      MASTER=bond0
      SLAVE=yes
      NM_CONTROLLED="no"
      ```
      ```bash
      # cat /etc/sysconfig/network-scripts/ifcfg-ens7
      DEVICE=ens7
      NAME=bond0-slave
      TYPE=Ethernet
      BOOTPROTO=none
      ONBOOT=yes
      MASTER=bond0
      SLAVE=yes
      NM_CONTROLLED="no"
      ```

      Для активвации/запуска `bond`-интерфейса активируем/запускаем все подчиненные интерфейсы:
      ```bash
      ifup ifcfg-ens3
      ```
      ```bash
      ifup ifcfg-ens7
      ```

      Debian/Ubuntu
      ```bash
      # apt-get install ifenslave
      ```
      ```bash
      # cat /etc/network/interfaces
      auto bond0

      iface bond0 inet static
          address 10.31.1.5
          netmask 255.255.255.0
          network 10.31.1.0
          gateway 10.31.1.254
          bond-slaves eth0 eth1
          bond-mode active-backup
          bond-miimon 100
          bond-downdelay 200
          bond-updelay 200
      ```
5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

   Сколько IP адресов в сети с маской /29 ?

   32-29=3

   2 в степени 3 = 8

   Минус один адрес на адрес и минус один адрес на широковещательный адрес

   Итого: 8-2=6 адресов


   Сколько /29 подсетей можно получить из сети с маской /24

   Есть несколько способов для такого определения:
   - Подсчет через размер маски в CIDR-формате
   29-24=5
   2 в степени 5 = 32
   т.е. 32 - это количество подсетей с маской /29 в сети /24

    - Подсчет через кол-во хостов в маске в CIDR-формате

   32-29=3
   2 в степени 3 = 8
   т.е. 8 адресов входит в подсеть /29 (включая адерс сетии широковещаетльный адрес)

   Общее количество адресов в подсети /24 = 256 - 2 в степени 8
   Количество подсетей с маской /29 можно получить внутри сети /24:
   256:8=32 т.е. 32 подсети

   Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24

   ```bash
   10.10.10.[0-7]/29
   10.10.10.[8-15]/29
   10.10.10.[16-23]/29
   ....
   10.10.10.[232-239]/29
   10.10.10.[240-247]/29
   10.10.10.[248-255]/29
   ```

6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

   `100.64.0.0 — 100.127.255.255` - Carrier-Grade NAT

    Для выделения адресов для 50-ти хостов, минимальная маска /26

   `100.64.0.0/26`

   `100.64.0.0-10.64.0.63`

   32-26=6

   2 в степени 6 = 64

   `100.64.0.0` - адрес подсети

   `100.64.0.63` - широковещаетльный адрес подсети

   Итого: `64-2=62` адреса для хостов

   Диапазаон хостов: `100.64.0.1-10.64.0.62`


7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

Проверка ARP таблицу в Linux:

```bash
# arp -a
```
Или
```bash
# ip neighb
```

Очистка ARP кеша полностью
```bash
# ip neigh flush all
```
Как из ARP таблицы удалить только один нужный IP
```bash
# arp -d <address>
```

 ---
## Задание для самостоятельной отработки (необязательно к выполнению)

 8*. Установите эмулятор EVE-ng.

 Инструкция по установке - https://github.com/svmyasnikov/eve-ng

 Выполните задания на lldp, vlan, bonding в эмуляторе EVE-ng.
